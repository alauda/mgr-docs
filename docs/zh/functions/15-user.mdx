---
weight: 15
---
# 用户管理

## 功能简介
提供完整的用户生命周期管理，包括创建、权限分配、密码修改和删除操作，支持RBAC权限模型。

## 安全特性
- 自动生成Kubernetes Secret存储凭证
- 支持TLS加密连接
- 审计日志记录

## 操作步骤
<Tabs>
    <Tab label="CLI">
        1. 创建用户密码
        ```bash
        kubectl -n ${namespace} create secret generic mgr-${instance_name}-${username}-password \
        --from-literal=host="%" \
        --from-literal=user=${username} \
        --from-literal=password=${password}
        ```

        ::: info

        - `${instance_name}` 为期望创建用户的实例名称
        - `${namespace}` 为实例所属的命名空间
        - `${username}` 为期望创建的用户名
        - `${password}` 为期望设置的密码

        :::

        2. 创建用户管理CR
        ```bash
        cat <<EOF | kubectl apply -f -
apiVersion: middleware.alauda.io/v1
kind: MysqlUser
metadata:
  labels:
    mgr/cluster: mgr
    mysql/arch: mgr
  name: mgr-dev
  namespace: tsl-x
spec:
  host: '%'
  mysql: mgr
  privileges:
    - grants:
        - SELECT
        - INSERT
        - UPDATE
        - DELETE
        - CREATE
        - DROP
        - REFERENCES
        - INDEX
        - ALTER
        - CREATE TEMPORARY TABLES
        - LOCK TABLES
        - CREATE VIEW
        - SHOW VIEW
        - CREATE ROUTINE
        - ALTER ROUTINE
        - EXECUTE
        - EVENT
        - TRIGGER
      targets:
        - dev
  secretName: mgr-dev
  user: dev
EOF
        ```
        2. 使用对应用户登录 MySQL
        3. 检查用户权限, 示例为 dev 用户:
        ```bash
        SHOW GRANTS;
        ```
        展示为:
        ```bash
        +----------------------------------------------+
        | Grants for dev@%                             |
        +----------------------------------------------+
        | GRANT USAGE ON *.* TO `dev`@`%`              |
        | GRANT ALL PRIVILEGES ON `dev`.* TO `dev`@`%` |
        +----------------------------------------------+
        ```
    </Tab>

    <Tab label="Web Console">
        1. 进入实例 **用户管理** 页签
        2. 点击 **创建用户**
        3. 配置参数：
        - 用户名：符合命名规范
        - 密码：符合复杂度要求
        - 权限：库级权限
        2. 使用对应用户登录 MySQL
        3. 检查用户权限, 示例为 dev 用户:
        ```bash
        SHOW GRANTS;
        ```
        展示为:
        ```bash
        +----------------------------------------------+
        | Grants for dev@%                             |
        +----------------------------------------------+
        | GRANT USAGE ON *.* TO `dev`@`%`              |
        | GRANT ALL PRIVILEGES ON `dev`.* TO `dev`@`%` |
        +----------------------------------------------+
        ```
    </Tab>
</Tabs>
