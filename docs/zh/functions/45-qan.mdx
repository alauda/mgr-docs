---
weight: 45
---
# 查询分析

## 功能简介
提供SQL查询的实时分析和历史追踪能力，帮助识别性能瓶颈、优化查询效率。基于MySQL Performance Schema和Slow Query Log实现。

## 核心功能
- 慢查询识别（默认 >2s）
- 执行计划解析
- 索引使用分析
- 锁等待统计
- 临时表监控

## 操作步骤
<Tabs>
<Tab label="CLI">
1. 开启慢查询日志
```bash
kubectl exec -n $namespace $name-primary -- mysql -uroot -p$password -e \
"SET GLOBAL slow_query_log=ON, long_query_time=2;"
```

2. 查看慢查询统计
```bash
kubectl exec -n $namespace $name-primary -- mysql -uroot -p$password -e \
"SELECT * FROM sys.schema_statistics_with_full_table_scans;"
```

3. 分析特定查询
```bash
kubectl exec -n $namespace $name-primary -- mysql -uroot -p$password -e \
"EXPLAIN FORMAT=JSON SELECT * FROM your_table WHERE your_condition;"
```
</Tab>

<Tab label="Web Console">
1. 进入实例 **查询分析** 页签
2. 设置分析条件：
   - 时间范围
   - 最小执行时间
   - 扫描行数阈值
3. 查看分析结果：
   - 高频低效查询
   - 缺失索引建议
   - 锁冲突统计
4. 保存分析报告
5. 对比历史趋势
</Tab>
</Tabs>

## 高级功能
1. 自动索引建议
2. 查询模式识别
3. 工作负载回放
4. 性能基线对比
